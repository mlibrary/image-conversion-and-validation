#!/usr/bin/env python3
# Copyright (c) 2017 The Regents of the University of Michigan.
# All Rights Reserved. Licensed according to the terms of the Revised
# BSD License. See LICENSE.txt for details.
from argparse import ArgumentParser

OS_ERRORS = (
    "ConnectionError",
    "BrokenPipe",
)

def iter_run (func, iterator):
    for i in iterator:
        func(i)

def fix_file(filename):
    with open(filename, "r") as f:
        text = f.read()

    if any(error in text for error in OS_ERRORS):
        for error in OS_ERRORS:
            text = text.replace(error, "OSError")
        with open(filename, "w") as f:
            f.write(text)

def parse_args():
    parser = ArgumentParser(description="Make backwards compatible")
    parser.add_argument("files",
                        nargs="*",
                        help="specific files to read")
    parser.add_argument("--version",
                        help="python version to run against")
    return parser.parse_args()

args = parse_args()

version = tuple(int(i) for i in args.version.split("."))

if version < (3, 3):
    iter_run(fix_file, args.files)
